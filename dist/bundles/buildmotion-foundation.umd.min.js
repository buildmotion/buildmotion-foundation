!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("buildmotion-logging"),require("rxjs/observable"),require("angular-actions"),require("angular-rules-engine"),require("@angular/http"),require("rxjs/Rx"),require("buildmotion-logging/severity.enum"),require("buildmotion-logging/logging.service"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","buildmotion-logging","rxjs/observable","angular-actions","angular-rules-engine","@angular/http","rxjs/Rx","buildmotion-logging/severity.enum","buildmotion-logging/logging.service","rxjs"],t):t(e.buildmotionFoundation={},e.ng.core,e.ng.common,e.buildmotionLogging,e.Rx.Observable.prototype,e.angularActions,e.angularRulesEngine,e.ng.http,e.Rx,e["buildmotionLogging/Severity"],e["buildmotionLogging/LoggingService"],e.Rx)}(this,function(e,t,r,i,o,n,s,a,c,u,g,l){"use strict";var h=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,i.BuildMotionLoggingModule],declarations:[]}]}],e.ctorParameters=function(){return[]},e}(),v=function(){return function(){this.IsSuccess=!1,this.Errors=new Array}}(),p=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.validateAction=function(){return this.validationContext.renderRules()},t.prototype.postValidateAction=function(){var e=this;this.loggingService.log(this.actionName,i.Severity.Information,"Preparing to determine if the action contains validation errors in "+this.actionName),this.validationContext.hasRuleViolations()&&(this.loggingService.log(this.actionName,i.Severity.Information,"The target contains validation errors in "+this.actionName),this.validationContext.results.forEach(function(t){t.isValid||(e.publishRuleResult(t),e.retrieveRuleDetails(t))}))},t.prototype.postExecuteAction=function(){var e=this;this.actionResult===n.ActionResult.Fail&&this.serviceContext.Messages.forEach(function(t){t.MessageType===s.MessageType.Error&&e.loggingService.log(e.actionName,i.Severity.Error,t.toString())})},t.prototype.validateActionResult=function(){if(this.loggingService.log(this.actionName,i.Severity.Information,"Running [validateActionResult] for "+this.actionName+"."),this.validationContext.hasRuleViolations()){this.loggingService.log(this.actionName,i.Severity.Error,"The "+this.actionName+" contains rule violations."),this.actionResult=n.ActionResult.Fail;var e=new v;e.IsSuccess=!1,e.Message="Validation errors exist.",this.response=o.Observable.throw(e)}return this.actionResult=this.serviceContext.isGood()?n.ActionResult.Success:n.ActionResult.Fail,this.actionResult},t.prototype.retrieveRuleDetails=function(e){var t=this;if(e.rulePolicy instanceof s.CompositeRule){var r=e.rulePolicy;if(r&&r.hasErrors){r.results.filter(function(e){return!e.isValid&&e.rulePolicy.isDisplayable}).forEach(function(e){t.publishRuleResult(e),e.rulePolicy instanceof s.CompositeRule&&t.retrieveRuleDetails(e)})}}},t.prototype.publishRuleResult=function(e){var t=new s.ServiceMessage(e.rulePolicy.name,e.rulePolicy.message,s.MessageType.Error);t.DisplayToUser=e.rulePolicy.isDisplayable,t.Source=this.actionName,this.serviceContext.Messages.push(t),this.loggingService.log(this.actionName,i.Severity.Error,""+t.toString())},t}(n.Action),y=function(){function e(e){this.loggingService=e,this.loggingService.log(this.serviceName,i.Severity.Information,"Running constructor for the [BusinessProviderBase].")}return e.prototype.handleUnexpectedError=function(e){var t=new s.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(s.MessageType.Error).WithSource(this.serviceName),r=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,i.Severity.Error,r),this.serviceContext.addMessage(t)},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,i.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,i.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.DisplayToUser&&e.MessageType===s.MessageType.Error}).forEach(function(e){return t.loggingService.log(t.serviceName,i.Severity.Error,e.toString())}))},e}(),d=function(){function e(e,t){this.http=e,this.loggingService=t,this.serviceName="HttpBaseService"}return e.prototype.createMultipartFormDataHeader=function(e){this.loggingService.log(this.serviceName,u.Severity.Information,"Preparing to create header for the [multipart/form-data] HTTP request. RequiresAuthToken: "+e+".");var t=new a.Headers;return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createFormUrlencodedHeader=function(){this.loggingService.log(this.serviceName,u.Severity.Information,"Preparing to create header for the [application/x-www-form-urlencoded] HTTP request.");return new a.Headers({"Content-Type":"application/x-www-form-urlencoded"})},e.prototype.createHeader=function(e){this.loggingService.log(this.serviceName,u.Severity.Information,"Preparing to create header for the HTTP request. RequiresAuthToken: "+e+".");var t=new a.Headers({"Content-Type":"application/json"});return e&&t.append("Authorization","Bearer "+this.accessToken),t},e.prototype.createRequestOptions=function(e,t,r,i){return this.loggingService.log(this.serviceName,u.Severity.Information,"Preparing to create request options for the HTTP request."),new a.RequestOptions({method:e,headers:t,url:r,body:i})},e.prototype.executeRequest=function(e){var t=this;return this.loggingService.log(this.serviceName,u.Severity.Information,"Preparing to execute HTTP request. Url: "+e.url+", Method: "+e.method),this.http.request(new a.Request(e)).map(function(e){return e.json()}).catch(function(r){return t.handleHttpError(r,e)})},e.prototype.handleHttpError=function(e,t){var r=e.toString()+" "+t.url+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,u.Severity.Error,r),!e||!e._body)return this.handleUnexpectedError(e);try{var i=e.json();if(i){return new c.BehaviorSubject(i).asObservable()}return this.handleUnexpectedError(e)}catch(e){var o=e,n=o.name+"; "+o.message;return this.loggingService.log(this.serviceName,u.Severity.Error,n),this.handleUnexpectedError(o)}},e.prototype.handleUnexpectedError=function(e){var t=this.createErrorResponse(e);return new c.BehaviorSubject(t).asObservable()},e.prototype.createErrorResponse=function(e){var t="Unexpected error while processing response.",r=new v;return e instanceof Error&&(t=e.name+" - "+e.message,r.Exception=e),r.Message=t,r},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:a.Http},{type:g.LoggingService}]},e}(),m=function(){function e(e){this.loggingService=e,this.serviceInitDateTime=new Date,this.accessToken="",this.serviceContext=new s.ServiceContext}return e.prototype.extractData=function(e){return e.json().data||{}},e.prototype.handleUnexpectedError=function(e){var t=new s.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(s.MessageType.Error).WithSource(this.serviceName),r=t.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,i.Severity.Error,r),this.serviceContext.addMessage(t)},e.prototype.handleOAuthError=function(e,t){var r=e.toString()+" "+t.url+", "+JSON.stringify(t.body);if(this.loggingService.log(this.serviceName,i.Severity.Error,r),e&&e._body)try{var o=this.createErrorResponse("Unable to validate credentials.");return new l.BehaviorSubject(o).asObservable()}catch(e){this.loggingService.log(this.serviceName,i.Severity.Error,e.toString())}var n=this.createErrorResponse("Unable to validate credentials.");return new l.BehaviorSubject(n).asObservable()},e.prototype.createErrorResponse=function(e){var t=new v;return t.Message=e,t},e.prototype.finishRequest=function(e){var t=this;this.loggingService.log(this.serviceName,i.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,i.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.MessageType===s.MessageType.Error&&e.DisplayToUser}).forEach(function(e){return t.loggingService.log(t.serviceName,i.Severity.Error,e.toString())}))},e}(),S=function(){return function(){}}(),b=function(){return function(){this.Errors=new Array}}();e.BuildMotionFoundationModule=h,e.ActionBase=f,e.BusinessProviderBase=y,e.HttpBaseService=d,e.ServiceBase=m,e.ErrorResponse=v,e.ServiceError=S,e.ServiceResponse=b,Object.defineProperty(e,"__esModule",{value:!0})});