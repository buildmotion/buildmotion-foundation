!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/common"),require("buildmotion-logging"),require("rxjs/observable"),require("angular-actions"),require("angular-rules-engine"),require("@angular/http"),require("rxjs/add/operator/cache"),require("rxjs/Rx"),require("buildmotion-logging/severity.enum"),require("buildmotion-logging/logging.service"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","buildmotion-logging","rxjs/observable","angular-actions","angular-rules-engine","@angular/http","rxjs/add/operator/cache","rxjs/Rx","buildmotion-logging/severity.enum","buildmotion-logging/logging.service","rxjs"],r):r(e.buildmotionFoundation={},e.ng.core,e.ng.common,e.buildmotionLogging,e.Rx.Observable.prototype,e.angularActions,e.angularRulesEngine,e.ng.http,null,e.Rx,e["buildmotionLogging/Severity"],e["buildmotionLogging/LoggingService"],e.Rx)}(this,function(e,r,t,i,o,n,s,a,c,u,l,g,h){"use strict";var v=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule,i.BuildMotionLoggingModule],declarations:[]}]}],e.ctorParameters=function(){return[]},e}(),p=function(){return function(){this.IsSuccess=!1,this.Errors=new Array}}(),f=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};return function(r,t){function i(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),d=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return f(r,e),r.prototype.validateAction=function(){return this.validationContext.renderRules()},r.prototype.postValidateAction=function(){var e=this;this.loggingService.log(this.actionName,i.Severity.Information,"Preparing to determine if the action contains validation errors in "+this.actionName),this.validationContext.hasRuleViolations()&&(this.loggingService.log(this.actionName,i.Severity.Information,"The target contains validation errors in "+this.actionName),this.validationContext.results.forEach(function(r){r.isValid||(e.publishRuleResult(r),e.retrieveRuleDetails(r))}))},r.prototype.postExecuteAction=function(){var e=this;this.actionResult===n.ActionResult.Fail&&this.serviceContext.Messages.forEach(function(r){r.MessageType===s.MessageType.Error&&e.loggingService.log(e.actionName,i.Severity.Error,r.toString())})},r.prototype.validateActionResult=function(){if(this.loggingService.log(this.actionName,i.Severity.Information,"Running [validateActionResult] for "+this.actionName+"."),this.validationContext.hasRuleViolations()){this.loggingService.log(this.actionName,i.Severity.Error,"The "+this.actionName+" contains rule violations."),this.actionResult=n.ActionResult.Fail;var e=new p;e.IsSuccess=!1,e.Message="Validation errors exist.",this.response=o.Observable.throw(e)}return this.actionResult=this.serviceContext.isGood()?n.ActionResult.Success:n.ActionResult.Fail,this.actionResult},r.prototype.retrieveRuleDetails=function(e){var r=this;if(e.rulePolicy instanceof s.CompositeRule){var t=e.rulePolicy;if(t&&t.hasErrors){t.results.filter(function(e){return!e.isValid&&e.rulePolicy.isDisplayable}).forEach(function(e){r.publishRuleResult(e),e.rulePolicy instanceof s.CompositeRule&&r.retrieveRuleDetails(e)})}}},r.prototype.publishRuleResult=function(e){var r=new s.ServiceMessage(e.rulePolicy.name,e.rulePolicy.message,s.MessageType.Error);r.DisplayToUser=e.rulePolicy.isDisplayable,r.Source=this.actionName,this.serviceContext.Messages.push(r),this.loggingService.log(this.actionName,i.Severity.Error,""+r.toString())},r}(n.Action),y=function(){function e(e){this.loggingService=e,this.loggingService.log(this.serviceName,i.Severity.Information,"Running constructor for the [BusinessProviderBase].")}return e.prototype.handleUnexpectedError=function(e){var r=new s.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(s.MessageType.Error).WithSource(this.serviceName),t=r.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,i.Severity.Error,t),this.serviceContext.addMessage(r)},e.prototype.finishRequest=function(e){var r=this;this.loggingService.log(this.serviceName,i.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,i.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.DisplayToUser&&e.MessageType===s.MessageType.Error}).forEach(function(e){return r.loggingService.log(r.serviceName,i.Severity.Error,e.toString())}))},e}(),m=function(){function e(e,r){this.http=e,this.loggingService=r,this.serviceName="HttpBaseService"}return e.prototype.createMultipartFormDataHeader=function(e){this.loggingService.log(this.serviceName,l.Severity.Information,"Preparing to create header for the [multipart/form-data] HTTP request. RequiresAuthToken: "+e+".");var r=new a.Headers;return e&&r.append("Authorization","Bearer "+this.accessToken),r},e.prototype.createFormUrlencodedHeader=function(){this.loggingService.log(this.serviceName,l.Severity.Information,"Preparing to create header for the [application/x-www-form-urlencoded] HTTP request.");return new a.Headers({"Content-Type":"application/x-www-form-urlencoded"})},e.prototype.createHeader=function(e){this.loggingService.log(this.serviceName,l.Severity.Information,"Preparing to create header for the HTTP request. RequiresAuthToken: "+e+".");var r=new a.Headers({"Content-Type":"application/json"});return e&&r.append("Authorization","Bearer "+this.accessToken),r},e.prototype.createRequestOptions=function(e,r,t,i){return this.loggingService.log(this.serviceName,l.Severity.Information,"Preparing to create request options for the HTTP request."),new a.RequestOptions({method:e,headers:r,url:t,body:i})},e.prototype.executeRequest=function(e){var r=this;return this.loggingService.log(this.serviceName,l.Severity.Information,"Preparing to execute HTTP request. Url: "+e.url+", Method: "+e.method),this.http.request(new a.Request(e)).map(function(e){return e.json()}).catch(function(t){return r.handleHttpError(t,e)})},e.prototype.handleHttpError=function(e,r){var t=e.toString()+" "+r.url+", "+JSON.stringify(r.body);if(this.loggingService.log(this.serviceName,l.Severity.Error,t),!e||!e._body)return this.handleUnexpectedError(e);try{var i=e.json();if(i){return new u.BehaviorSubject(i).asObservable()}return this.handleUnexpectedError(e)}catch(e){var o=e,n=o.name+"; "+o.message;return this.loggingService.log(this.serviceName,l.Severity.Error,n),this.handleUnexpectedError(o)}},e.prototype.handleUnexpectedError=function(e){var r=this.createErrorResponse(e);return new u.BehaviorSubject(r).asObservable()},e.prototype.createErrorResponse=function(e){var r="Unexpected error while processing response.",t=new p;return e instanceof Error&&(r=e.name+" - "+e.message,t.Exception=e),t.Message=r,t},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:a.Http},{type:g.LoggingService}]},e}(),S=function(){function e(e){this.loggingService=e,this.serviceInitDateTime=new Date,this.accessToken="",this.serviceContext=new s.ServiceContext}return e.prototype.extractData=function(e){return e.json().data||{}},e.prototype.handleUnexpectedError=function(e){var r=new s.ServiceMessage(e.name,e.message).WithDisplayToUser(!0).WithMessageType(s.MessageType.Error).WithSource(this.serviceName),t=r.toString()+"; "+e.stack;this.loggingService.log(this.serviceName,i.Severity.Error,t),this.serviceContext.addMessage(r)},e.prototype.handleOAuthError=function(e,r){var t=e.toString()+" "+r.url+", "+JSON.stringify(r.body);if(this.loggingService.log(this.serviceName,i.Severity.Error,t),e&&e._body)try{var o=this.createErrorResponse("Unable to validate credentials.");return new h.BehaviorSubject(o).asObservable()}catch(e){this.loggingService.log(this.serviceName,i.Severity.Error,e.toString())}var n=this.createErrorResponse("Unable to validate credentials.");return new h.BehaviorSubject(n).asObservable()},e.prototype.createErrorResponse=function(e){var r=new p;return r.Message=e,r},e.prototype.finishRequest=function(e){var r=this;this.loggingService.log(this.serviceName,i.Severity.Information,"Request for ["+e+"] by "+this.serviceName+" is complete."),this.serviceContext.hasErrors()&&(this.loggingService.log(this.serviceName,i.Severity.Information,"Preparing to write out the errors."),this.serviceContext.Messages.filter(function(e){return e.MessageType===s.MessageType.Error&&e.DisplayToUser}).forEach(function(e){return r.loggingService.log(r.serviceName,i.Severity.Error,e.toString())}))},e}(),b=function(){return function(){}}(),R=function(){return function(){this.Errors=new Array}}();e.BuildMotionFoundationModule=v,e.ActionBase=d,e.BusinessProviderBase=y,e.HttpBaseService=m,e.ServiceBase=S,e.ErrorResponse=p,e.ServiceError=b,e.ServiceResponse=R,Object.defineProperty(e,"__esModule",{value:!0})});